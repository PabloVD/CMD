

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Benchmark &mdash; Camels Multifield Challenge 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Terminology" href="terminology.html" />
    <link rel="prev" title="Data" href="description_maps.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Camels Multifield Challenge
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>
<p class="caption"><span class="caption-text">Description</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="science.html">Science</a></li>
<li class="toctree-l1"><a class="reference internal" href="goals.html">Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="description_maps.html">Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Benchmark</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requisites">Requisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#organization">Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scripts">scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#databases">databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#weights">weights</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="help.html">Help</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Camels Multifield Challenge</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Benchmark</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/description_benckmark.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="benchmark">
<h1>Benchmark<a class="headerlink" href="#benchmark" title="Permalink to this headline">¶</a></h1>
<p>For the 2D maps, CMC provides a benchmark to compare the results with. It consists in the codes written to train and test the networks together with their actual weights.</p>
<div class="section" id="requisites">
<h2>Requisites<a class="headerlink" href="#requisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>python3</p></li>
<li><p>numpy</p></li>
<li><p><a class="reference external" href="https://pytorch.org">Pytorch</a></p></li>
<li><p><a class="reference external" href="https://optuna.org">optuna</a></p></li>
</ul>
</div>
<div class="section" id="organization">
<h2>Organization<a class="headerlink" href="#organization" title="Permalink to this headline">¶</a></h2>
<p>The folder containing the codes and weights is called <code class="docutils literal notranslate"><span class="pre">benchmark</span></code>, and is located within the <code class="docutils literal notranslate"><span class="pre">2D_maps</span></code> folder. Inside it, there are three folders called <code class="docutils literal notranslate"><span class="pre">scripts</span></code>, containing the codes used to train and test the networks, <code class="docutils literal notranslate"><span class="pre">databases</span></code> with the optuna databases and <code class="docutils literal notranslate"><span class="pre">weights</span></code>, that has the weights of the networks.</p>
</div>
<div class="section" id="scripts">
<h2>scripts<a class="headerlink" href="#scripts" title="Permalink to this headline">¶</a></h2>
<p>This folder contains the following codes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">architecture.py</span></code>. This script contains different architecture models.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.py</span></code>. This script process the data to train the networks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train.py</span></code>. This is the code used to train the network.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test.py</span></code>. This is the code used to test the network.</p></li>
</ul>
<p>To train a new model on a given field, or a multifield, follow these steps:</p>
<ol class="arabic simple">
<li><p>Open the code <code class="docutils literal notranslate"><span class="pre">train.py</span></code> and set the value of the different parameters in the INPUT section.</p></li>
<li><p>Run the code: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">train.py</span></code>. Note that when using optuna, several trials can be run in parallel (see the optuna documentation for details).</p></li>
<li><p>The code will output an optuna database, and will save the losses and weights of each of the considered trials.</p></li>
</ol>
<p>To test a model on a given field(s), or a multifield, follow these steps:</p>
<ol class="arabic simple">
<li><p>Open the code <code class="docutils literal notranslate"><span class="pre">test.py</span></code> and set the value of the different parameters in the INPUT section.</p></li>
<li><p>Run the code: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">test.py</span></code>.</p></li>
<li><p>The code will generate a file with true value of the parameters, together with the mean and standard deviation of the posterior for each parameter.</p></li>
</ol>
<p>This <a class="reference external" href="https://colab.research.google.com/drive/1-BmkA8JSc36O8g9pj7FenD1YSLKqjQR3?usp=sharing">colab</a> shows an example on how to train and test a model using these scripts.</p>
</div>
<div class="section" id="databases">
<h2>databases<a class="headerlink" href="#databases" title="Permalink to this headline">¶</a></h2>
<p>We use the optuna software to find the best value of the hyperparameters (learning rate, weight decay…etc) of one particular model. Typically, for each field, we perform 50 trials, where a trial corresponds to the training carried out with one particular choice of the value of the hyperparameters. This folder contains the databases created by optuna with the information about the different trials for the different simulation types.</p>
<p>The generic name of one of these files is <code class="docutils literal notranslate"><span class="pre">sim_o3_field_all_steps_500_500_o3.db</span></code> where <code class="docutils literal notranslate"><span class="pre">sim</span></code> can be IllustrisTNG, SIMBA, or Nbody, <code class="docutils literal notranslate"><span class="pre">field</span></code> is the considered field (can be several fields together). In some cases we smooth out the fields with a Gaussian kernel with width <code class="docutils literal notranslate"><span class="pre">width</span></code> (in pixel units). The generic name of these files is <code class="docutils literal notranslate"><span class="pre">sim_o3_field_all_steps_500_500_o3_smoothing_width.db</span></code>.</p>
<p>These files can be read with optuna package, and two arguments are needed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">study_name</span></code>. For all our databases, this variable is set to <code class="docutils literal notranslate"><span class="pre">wd_dr_hidden_lr_o3</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">storage</span></code>. This should be set to the a sqlite database with the name of the file, e.g. <code class="docutils literal notranslate"><span class="pre">sqlite:////home/fvillaescusa/CMC/2D_maps/benchmark/databases/SIMBA_o3_HI_all_steps_500_500_o3.db</span></code></p></li>
</ul>
<p>We provide an example on how to read the information of these files in this <a class="reference external" href="https://colab.research.google.com/drive/1ab79y_nIr2JkkgtT_QJhjLTJYNjY9M0B?usp=sharing">colab</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The databases files are very light (typically less than 1 Mb each), so they all can be downloaded easily. The files containing the network weights are however bigger (~100 Mb), so it may be a good idea to only download the weights for the best model or the top 5 models.</p>
</div>
</div>
<div class="section" id="weights">
<h2>weights<a class="headerlink" href="#weights" title="Permalink to this headline">¶</a></h2>
<p>This folder contains the weights of all the models trained. Thus, for each field, there will be at least 50 different files containing the weights of the 50 different trials considered. The generic name of these files is <code class="docutils literal notranslate"><span class="pre">weights_sim_field_trialnumber_all_steps_500_500_o3.pt</span></code>, where <code class="docutils literal notranslate"><span class="pre">sim</span></code> can be IllustrisTNG, SIMBA, or Nbody, <code class="docutils literal notranslate"><span class="pre">field</span></code> is the name of the considered field (can be several of them), and <code class="docutils literal notranslate"><span class="pre">trialnumber</span></code> is the trial number. In the cases where the neural network is trained on fields that are smoothed with a Gaussian kernel, the generic name of the files is <code class="docutils literal notranslate"><span class="pre">weights_sim_field_trialnumber_all_steps_500_500_o3_smoothing_width.pt</span></code>, where width is the width of the Gaussian kernel in pixel units.</p>
<p>These files can be read by Pytorch routines once the architecture is specified. In all the cases, the architecture employed is <code class="docutils literal notranslate"><span class="pre">o3_err</span></code> (see <code class="docutils literal notranslate"><span class="pre">architecture.py</span></code> from the released codes). We provide an example on how to read these files in this <a class="reference external" href="https://colab.research.google.com/drive/18Bbwb30m1dqFccAZlUsJPNaH9iTNOibS?usp=sharing">colab</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="terminology.html" class="btn btn-neutral float-right" title="Terminology" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="description_maps.html" class="btn btn-neutral float-left" title="Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Francisco Villaescusa-Navarro

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>